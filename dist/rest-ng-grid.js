!function(t,e,n){"use strict";var i=(e.isDefined,e.isUndefined,e.isFunction,e.isString,e.isNumber,e.isObject,e.isArray,e.forEach);e.extend,e.copy,e.equals;e.module("restNgGrid",["ui.bootstrap","ngResource"]).constant("restNgGridConfig",{options:{gridUniqueId:null,gridClass:"",columns:{titles:null,fields:[]},footer:"",childCount:"children",childrenParam:"",editMode:"modal",rowOptions:"dropdown",hierarchy:!1,dataSource:{transport:{},type:"odb"}}}).factory("restNgGridService",["$http","$q","$resource",function(t,n,r){return{urlBuilder:function(t,n){var r=t,a=/{[^}]*}/g,l=r.match(a);return i(l,function(t,a){var l=t.length,d=t.substring(1,l-1).split("."),s=e.copy(n);i(d,function(t,e){s&&(s=s[t])}),r=r.replace(t,s)}),r},updateChildrenColumn:function(t,n){var i=function(r){r.children&&e.forEach(r.children,function(e){e[n]=t[n],i(e)})};i(t)},query:function(e){var i=n.defer();return t({mtehod:"GET",url:e}).then(function(t){t&&i.resolve(t.data)},function(t){t&&i.reject([])}),i.promise},"delete":function(e){var i=n.defer();return t["delete"](e).then(function(t){t&&i.resolve(t)},function(t){t&&i.reject(t)}),i.promise},update:function(e,i){var r=n.defer();return t({method:"PUT",url:e,data:i}).then(function(t){t&&r.resolve(t.data)},function(t){t&&r.reject([])}),r.promise}}}]).controller("RestNgGridCtrl",["$rootScope","$scope","$element","$attrs","$compile","restNgGridConfig","restNgGridService","$uibModal","$resource","$filter","$locale",function(t,n,r,a,l,d,s,o,c,u,p){function g(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function m(t){if(t){for(;t.length>0;)t.pop();return t}}function f(t,n){var i;for(i in n)t.hasOwnProperty(i)&&(e.isObject(t[i])?f(t[i],n[i]):t&&(n[i]=t[i]));return n}function h(t,i){n.options.dataSource.transport&&n.options.dataSource.transport.query?(I=s.urlBuilder(n.options.dataSource.transport.query,t),s.query(I).then(function(t){n.options.dataSource.arrayListParam&&(t=t[n.options.dataSource.arrayListParam]),Array.isArray(t)||(t=[t]),N.orderBy&&(t=u("orderBy")(t,N.orderBy)),m(n.items),e.forEach(t,function(t){n.items.push(t)})},function(t){m(n.items)})):"tree"==n.options.dataSource.type&&(m(n.items),e.forEach(i.children,function(t){n.items.push(t)}))}function C(t){n.updateRow(t).then(function(n){e.extend(t,n),N.inlineMode.id=null},function(e){N.cancelEditMode(t)})}function v(t,n){var i=!1,r=t;return e.isObject(n.isEditable)?n.isEditable.path?(e.forEach(n.isEditable.path,function(t){r&&(r=r[t])}),n.isEditable.trueValue==r&&(i=!0)):i=!1:i=n.isEditable,i}var N=this;this.gId=g(),this.titleList=[],this.titleLength=0,this.columnList=[],this.isTranscluded=!1,this.restNgGridService=s,this.options={},this.inlineMode={id:null};var G=null;this.options=e.merge({},d.options,n.options),this.apiUrl=this.options.dataSource.transport,n.items=n.items||[];var I="";this.orderBy=this.options.columns.orderBy,this.parentId=this.options.dataSource.parentId||"id",this.itemId=this.options.dataSource.itemId,n.currentItem={id:null},n.localeId=p.id,this.addColumns=function(t,n){if(n&&n.columns&&n.columns.titles&&(e.isArray(n.columns.titles)?(i(n.columns.titles,function(e){t.titleList.push(e)}),t.titleLength=n.columns.titles.length):e.isNumber(n.columns.titles)&&(t.titleLength=n.columns.titles)),n&&n.columns&&n.columns.fields){var r,a="",l=0,d="",s="",o="",c={},u={},p=!1,g="",m=!1,f="",h=null;i(n.columns.fields,function(e){a=e.field||"",l=e.colspan||0,d=e.style||{width:"auto"},s=e.filter||{name:"",format:""},o=e.type||"text",c=e.validation||{required:!1},u=e.visibility||{bitMask:null,field:[]},p=e.isEditable||!1,g=e.link||"",m=e.onChange||!1,f=e.inputName||"mj-input",h=e.radioValue||null,r=e.changeChildren||!1,t.columnList.push({field:a,colspan:l,style:d,filter:s,type:o,validation:c,visibility:u,isEditable:p,link:g,onChange:m,inputName:f,radioValue:h,changeChildren:r})})}},this.closeGroups=function(){i(n.items,function(t){t.isOpen=!1})},this.toggleRow=function(i,r){i&&(i.preventDefault(),i.stopImmediatePropagation()),N.isTranscluded&&(r.isOpen=!r.isOpen),e.isFunction(n.selectItem)&&n.selectItem(r),t.$broadcast("selectRow",{id:r.id,gId:N.gId}),r.isOpen&&(N.itemId&&(n.params[N.itemId]=r.id),"tree"==n.options.dataSource.type?t.$broadcast("expandRow",r):(n.params=f(r,n.params),t.$broadcast("expandRow",{id:r.id,gId:N.gId})))},this.selectRow=function(i,r,a){!i||a||a.link||(i.preventDefault(),i.stopImmediatePropagation()),n.currentItem.id=r.id,e.isFunction(n.selectItem)&&n.selectItem(r),t.$broadcast("selectRow",{id:r.id,gId:N.gId})};var b=t.$on("expandRow",function(t,e){n.$parent.parentItem&&n.$parent.parentItem.id===e.id&&n.$parent.parentItem.gId===e.gId&&(n.params=n.$parent.params,h(n.params,e))}),y=t.$on("selectRow",function(t,e){N.gId==e.gId?n.currentItem.id=e.id:n.currentItem.id=null}),w=t.$on("addNewRow",function(t,e){n.$parent.parentItem&&n.$parent.parentItem.id===e.item[N.parentId]&&(N.options.gridUniqueId&&N.options.gridUniqueId===e.gridUniqueId?n.items.push(e.item):N.options.gridUniqueId||n.items.push(e.item))});this.addItem=function(t){N.inlineMode.id=null,G=null,n.addRow&&n.addRow(t).then(function(t){n.options.dataSource.transport.query&&(e.isArray(n.items)||(n.items=[n.items]),t&&n.items.push(t))},function(t){})},this.addChildItem=function(e){N.inlineMode.id=null,G=null,n.addChildRow(e).then(function(n){N.toggleRow(null,e),e[N.options.childCount]=e[N.options.childCount]+1,N.selectRow(null,e),t.$broadcast("addNewRow",{item:n})},function(){console.log("handle error")})},this.editItem=function(t){n.params[N.itemId]=t.id,n.params[N.parentId]=t[N.parentId],"inline"==N.options.editMode&&(N.inlineMode.id=t.id,G=e.copy(t)),n.updateRow&&"modal"==N.options.editMode&&C(t)},this.saveRow=function(t,i){n.params[N.itemId]=t.id,n.params[N.parentId]=t[N.parentId],n.updateRow?C(t):(I=s.urlBuilder(N.apiUrl.update,n.params),N.restNgGridService.update(I,t).then(function(n){e.extend(t,n),N.inlineMode.id=null},function(e){N.cancelEditMode(t)}))},this.cancelEditMode=function(t){N.inlineMode.id=null,e.extend(t,G),G=null},this.ModalInstanceDelete=function(t,e,n){return t.deleteObjectName=n,t.confirm=function(t){return e.close(t)},t.cancel=function(){return e.dismiss("cancel")}},this.deleteItem=function(t){N.deleteRow(t)},this.deleteRow=function(t){var e="";return o.open({templateUrl:"templates/partials/directives/delete.html",controller:N.ModalInstanceDelete,animation:!1,backdrop:!0,resolve:{name:function(){return t.name}}}).result.then(function(){n.params[N.itemId]=t.id,n.params[N.parentId]=t[N.parentId],e=s.urlBuilder(N.apiUrl["delete"],n.params),N.restNgGridService["delete"](e).then(function(e){var i=n.items.indexOf(t);i>=0&&n.items.splice(i,1)},function(t){console.log("handle error")})})},this.getValue=function(t,n,i,r){var a=t,l=null;return e.isArray(n)||(n=[n]),!r||(e.isArray(r.field)||(r.field=[r.field]),e.forEach(r.field,function(t){l=a[t]}),!l||r.bitMask&l)?(i&&!e.isArray(i)&&(i=[i]),e.forEach(n,function(t){a&&(a=a[t])}),e.forEach(i,function(t){a&&t.name&&t.format&&(a=u(t.name)(a,t.format))}),a):""},this.checkIfContent=function(t,e){var i=v(t,e);return N.inlineMode.id!==t.id&&!n.editAllRows||!i},this.checkIfEdit=function(t,e){var i=v(t,e);return(N.inlineMode.id==t.id||n.editAllRows)&&i},this.checkIfRowEditable=function(t){var n=!1;return e.forEach(N.columnList,function(e){n||(n=v(t,e))}),n},this.changeCellEvent=function(t,e){e.onChange&&e.onChange(t),e.changeChildren&&"tree"!==n.options.dataSource.type?n.$broadcast("changeChildren",{item:t,column:e}):e.changeChildren&&s.updateChildrenColumn(t,e.field)},this.onCellLinkClick=function(t,e,n){n(t[e])},n.$watch("getDataTrigger",function(t){t&&(m(n.items),h(n.params,t),n.getDataTrigger=!1)}),n.$watch("getExpandRowTrigger",function(t){t&&N.selectRow(null,{id:t})});var $=t.$on("editTriggerHandler",function(t,e){"all"==e.type&&(n.editAllRows=e.status)}),R=n.$on("changeChildren",function(t,e){});n.editTrigger=function(e){"all"==e.type&&t.$broadcast("editTriggerHandler",{type:e.type,status:e.status})},n.$on("$localeChangeSuccess",function(t){n.localeId=p.id}),n.$on("$destroy",b,w,$,y,R)}]).directive("restNgGrid",["$compile","$templateCache",function(t,e){return{restrict:"EA",transclude:!0,template:e.get("rest-ng-grid.html"),controller:"RestNgGridCtrl",controllerAs:"restNgGridCtrl",scope:{options:"=?",items:"=?",params:"=?",addRow:"=?",addChildRow:"=?",updateRow:"=?",getDataTrigger:"=?",editTrigger:"=?",gridClass:"@",footerOptions:"=?",selectItem:"=?",isReadOnly:"=?",getExpandRowTrigger:"=",editAllRows:"="},link:function(t,e,n,i){i.addColumns(i,i.options)}}}]).directive("restNgGridTransclude",["$templateCache","$compile",function(t,e){function n(t,e,n,i,r){var a,l;if(i){var d=t.$parent.$parent.$new();d.parentItem=t.$eval(n.currentItem),d.parentItem.gId=i.gId,d.params=t.$eval(n.params),r(d,function(t,n){e.empty(),t.length>0?i.isTranscluded=!0:i.isTranscluded=!1,e.append(t),a=t,l=n})}e.on("$destroy",function(){a.remove(),l.$destroy()})}return{require:"^?restNgGrid",link:n,restrict:"A"}}]).directive("restGridChildren",["$templateCache",function(t){return{restrict:"E",replace:!0,template:t.get("rest-ng-grid-select-group.html"),scope:{collection:"=?",options:"=?",field:"=",filter:"="},link:function(t,n,i){t.collection&&(e.isArray(t.collection)||(t.collection=[t.collection])),t.setValue=function(t,n,i){var r=t;return e.isArray(n)||(n=[n]),i&&!e.isArray(i)&&(i=[i]),e.forEach(n,function(t){r&&(r=r[t])}),e.forEach(i,function(t){r&&t.name&&t.format&&(r=$filter(t.name)(r,t.format))}),r}}}}])}(window,window.angular),function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid-select-group.html",'<div class="list">\n    <ul>\n        <li data-ng-include="\'rest-ng-grid-sub-level.html\'"\n            data-ng-repeat="member in collection"></li>\n    </ul>\n</div>')}])}(),function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid-sub-level.html",'<span>{{ setValue(member, field, filter) }}</span>\n<ul>\n    <li ng-repeat="member in member[options.childrenParam]" ng-include="\'rest-ng-grid-sub-level.html\'"></li>\n</ul>')}])}(),function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid.html",'<div  data-ng-style="{{ restNgGridCtrl.options.style }}" class="mj-grid {{ restNgGridCtrl.options.gridClass }}"\n\t  data-ng-class="{\'no-title\':\nrestNgGridCtrl.titleList.length == 0}">\n\t<div class="mj-grid-header">\n\t\t<div class="mj-grid-header-wrap"></div>\n\t</div>\n\t<div class="mj-grid-content">\n\t\t<!--{{ $id }}-->\n\t\t<table role="grid" class="table table-responsive out">\n\t\t\t<thead role="rowgroup" data-ng-if="restNgGridCtrl.titleList.length > 0">\n\t\t\t<tr role="row">\n\t\t\t\t<th ng-style="{{ t.style }}" colspan="{{ t.colspan }}" role="columnheader"\n\t\t\t\t\tdata-ng-repeat="t in restNgGridCtrl.titleList">\n\t\t\t\t\t<span ng-show="t.title[localeId]">{{ t.title[localeId] }}</span>\n\t\t\t\t\t<span ng-show="!t.title[localeId]">{{ t.title }}</span>\n\t\t\t\t</th>\n\t\t\t\t<th class="text-right"\n\t\t\t\t\tdata-ng-if="(restNgGridCtrl.apiUrl.save || restNgGridCtrl.apiUrl.update || restNgGridCtrl.apiUrl.delete) && !isReadOnly">\n\t\t\t\t\t<a data-ng-if="restNgGridCtrl.apiUrl.save" href="" ng-click="restNgGridCtrl.addItem()"><i class="fa fa-plus"></i></a>\n\t\t\t\t</th>\n\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody role="rowgroup">\n\t\t\t<tr class="m-master"\n\t\t\t\tdata-ng-repeat-start="item in items" data-ng-class="{\'active\': currentItem.id == item.id}">\n\t\t\t\t<td ng-style="{{ c.style }}" colspan="{{ c.colspan }}" data-ng-click="restNgGridCtrl.selectRow($event, item, c)"\n\t\t\t\t\tdata-ng-repeat="c in restNgGridCtrl.columnList">\n\t\t\t\t\t<a href=""\n\t\t\t\t\t   data-ng-if="(((item[restNgGridCtrl.options.childCount] > 0 || item.children.length > 0) ||\n\t\t\t\t\t\t(!item[restNgGridCtrl.options.childCount] && item[restNgGridCtrl.options.childCount] != 0)) && $index == 0 &&\n\t\t\t\t\t\trestNgGridCtrl.isTranscluded)"\n\t\t\t\t\t   class="sub fa"\n\t\t\t\t\t   data-ng-click="restNgGridCtrl.toggleRow($event, item)"\n\t\t\t\t\t   data-ng-class="{\'fa-plus-square-o\': !item.isOpen, \'fa-minus-square-o\': item.isOpen}">&nbsp;</a>\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tdata-ng-if="(item[restNgGridCtrl.options.childCount] == 0 && $index == 0 && restNgGridCtrl.isTranscluded) ||\n\t\t\t\t\t\t\t(restNgGridCtrl.options.dataSource.type == \'tree\' && item.children.length == 0 && $index == 0)"\n\t\t\t\t\t\t\tclass="sub fa fa-square-o">&nbsp;</span>\n\n\t\t\t\t\t<div class="cell-content">\n\t\t\t\t\t\t<span data-ng-if="restNgGridCtrl.checkIfContent(item, c)">\n\t\t\t\t\t\t\t<span data-ng-if="!c.link">{{ restNgGridCtrl.getValue(item, c.field, c.filter, c.visibility) }}</span>\n\t\t\t\t\t\t\t<a data-ng-if="c.link" data-ng-click="restNgGridCtrl.onCellLinkClick(item, c.field, c.link)" >{{\n\t\t\t\t\t\t\t\trestNgGridCtrl.getValue(item,\n\t\t\t\t\t\t\t\t\tc.field,\n\t\t\t\t\t\t\t\t\tc.filter,\n\t\t\t\t\t\t\t\t\tc.visibility) }}</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span data-ng-if="restNgGridCtrl.checkIfEdit(item, c)">\n\t\t\t\t\t\t\t<input data-ng-change="restNgGridCtrl.changeCellEvent(item, c)" type="{{ c.type }}" class="form-control\n\t\t\t\t\t\t\tinput-sm" data-ng-model="item[c.field]" name="{{ c.inputName }}" ng-value="{{ c.radioValue }}"\n\t\t\t\t\t\t\t\t   data-ng-required="c.validation.required" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<ul class="mj-children" data-ng-if="item[restNgGridCtrl.options.childrenParam]">\n\t\t\t\t\t\t\t<li  data-ng-repeat="itemCh in item[restNgGridCtrl.options.childrenParam]">\n\t\t\t\t\t\t\t\t<!--{{ restNgGridCtrl.getValue(itemCh, c.field, c.filter) }}-->\n\t\t\t\t\t\t\t\t<rest-grid-children collection="[itemCh]" field="c.field" filter="c.filter"\n\t\t\t\t\t\t\t\t\t\t\t\t  options="{childrenParam:\'children\'}" />\n\n\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t\t<td class="dropdown-menu-td" data-ng-if="(restNgGridCtrl.apiUrl.save || restNgGridCtrl.apiUrl.update ||\n        restNgGridCtrl.apiUrl.delete) &&\n        !isReadOnly">\n\t\t\t\t\t<div data-ng-if="restNgGridCtrl.options.rowOptions == \'dropdown\'" class="dropdown right" uib-dropdown>\n\t\t\t\t\t\t<a href=""  class="dropdown-toggle" uib-dropdown-toggle>\n\t\t\t\t\t\t\t<i class="fa fa-cogs small"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="dropdown-menu extended small" uib-dropdown-menu>\n\t\t\t\t\t\t\t<li data-ng-if="restNgGridCtrl.apiUrl.save && addChildRow && restNgGridCtrl.isTranscluded">\n\t\t\t\t\t\t\t\t<a href="" data-ng-click="restNgGridCtrl.addChildItem(item, $event)"><span class="fa fa-plus"></span> Add</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li data-ng-if="restNgGridCtrl.apiUrl.update">\n\t\t\t\t\t\t\t\t<a href="" data-ng-click="restNgGridCtrl.editItem(item, $event)"><span class="fa fa-pencil"></span> Edit</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li data-ng-if="restNgGridCtrl.apiUrl.delete">\n\t\t\t\t\t\t\t\t<a href="" data-ng-click="restNgGridCtrl.deleteItem(item, $event)"><span class="fa fa-times"></span>Delete\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-ng-if="(restNgGridCtrl.options.rowOptions == \'inline\') && !isReadOnly" class="list-options no-drp">\n\t\t\t\t\t\t<button data-ng-if="restNgGridCtrl.inlineMode.id == item.id"\n\t\t\t\t\t\t\t\tclass="h-r"\n\t\t\t\t\t\t\t\tdata-ng-click="restNgGridCtrl.cancelEditMode(item)">\n\t\t\t\t\t\t\t<span class="fa fa-close"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button data-ng-if="restNgGridCtrl.inlineMode.id == item.id"\n\t\t\t\t\t\t\t\tclass="h-r"\n\t\t\t\t\t\t\t\tdata-ng-click="restNgGridCtrl.saveRow(item, $event)">\n\t\t\t\t\t\t\t<span class="fa fa-check"></span>\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<button data-ng-if="restNgGridCtrl.apiUrl.save && addChildRow && restNgGridCtrl.isTranscluded && !restNgGridCtrl.inlineMode.id"\n\t\t\t\t\t\t\t\tuib-tooltip-popup-delay="100"\n\t\t\t\t\t\t\t\tuib-tooltip="Add child"\n\t\t\t\t\t\t\t\ttooltip-placement="bottom"\n\t\t\t\t\t\t\t\tclass="h-r"\n\t\t\t\t\t\t\t\tdata-ng-click="restNgGridCtrl.addChildItem(item, $event)">\n\t\t\t\t\t\t\t<span class="fa fa-plus"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button data-ng-if="restNgGridCtrl.apiUrl.update && !restNgGridCtrl.inlineMode.id &&\n\t\t\t\t\t\trestNgGridCtrl.checkIfRowEditable(item)"\n\t\t\t\t\t\t\t\tuib-tooltip-popup-delay="100"\n\t\t\t\t\t\t\t\tuib-tooltip="Edit"\n\t\t\t\t\t\t\t\ttooltip-placement="bottom"\n\t\t\t\t\t\t\t\tclass="h-r"\n\t\t\t\t\t\t\t\tdata-ng-click="restNgGridCtrl.editItem(item, $event)">\n\t\t\t\t\t\t\t<span class="fa fa-pencil"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button data-ng-if="restNgGridCtrl.apiUrl.delete && !restNgGridCtrl.inlineMode.id" uib-tooltip-popup-delay="100"\n\t\t\t\t\t\t\t\tuib-tooltip="Delete"\n\t\t\t\t\t\t\t\ttooltip-placement="bottom"\n\t\t\t\t\t\t\t\tclass="h-r"\n\t\t\t\t\t\t\t\tdata-ng-click="restNgGridCtrl.deleteItem(item, $event)">\n\t\t\t\t\t\t\t<span class="fa fa-times"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr data-ng-show="restNgGridCtrl.isTranscluded && item.isOpen"\n\t\t\t\tclass="m-detail"\n\t\t\t\tdata-ng-repeat-end>\n\t\t\t\t<td colspan="{{ restNgGridCtrl.titleLength + 2}}" rest-ng-grid-transclude current-item="item"\n\t\t\t\t\tparams="params">&nbsp;</td>\n\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n\t<div id="mj-footer" class="mj-grid-footer" ng-include="restNgGridCtrl.options.footer">\n\n\t</div>\n</div>')}])}();