!function(t,e,i){"use strict";var n=(e.isDefined,e.isUndefined,e.isFunction,e.isString,e.isNumber,e.isObject,e.isArray,e.forEach);e.extend,e.copy,e.equals;e.module("restNgGrid",["ui.bootstrap","ngResource"]).constant("restNgGridConfig",{options:{gridUniqueId:null,gridClass:"",columns:{titles:null,fields:[]},footer:"",childCount:"children",childrenParam:"",editMode:"modal",rowOptions:"dropdown",hierarchy:!1,dataSource:{transport:{},type:"odb"}}}).factory("restNgGridService",["$http","$q","$resource",function(t,i,r){return{urlBuilder:function(t,i){var r=t,a=/{[^}]*}/g,l=r.match(a);return n(l,function(t,a){var l=t.length,d=t.substring(1,l-1).split("."),s=e.copy(i);n(d,function(t,e){s&&(s=s[t])}),r=r.replace(t,s)}),r},updateChildrenColumn:function(t,i){var n=function(r){r.children&&e.forEach(r.children,function(e){e[i]=t[i],n(e)})};n(t)},query:function(e){var n=i.defer();return t({mtehod:"GET",url:e}).then(function(t){t&&n.resolve(t.data)},function(t){t&&n.reject([])}),n.promise},"delete":function(e){var n=i.defer();return t["delete"](e).then(function(t){t&&n.resolve(t)},function(t){t&&n.reject(t)}),n.promise},update:function(e,n){var r=i.defer();return t({method:"PUT",url:e,data:n}).then(function(t){t&&r.resolve(t.data)},function(t){t&&r.reject([])}),r.promise}}}]).controller("RestNgGridCtrl",["$rootScope","$scope","$element","$attrs","$compile","restNgGridConfig","restNgGridService","$uibModal","$resource","$filter","$locale","$templateCache",function(t,i,r,a,l,d,s,o,c,u,p,g){function m(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function f(t){if(t){for(;t.length>0;)t.pop();return t}}function h(t,i){var n;for(n in i)t.hasOwnProperty(n)&&(e.isObject(t[n])?h(t[n],i[n]):t&&(i[n]=t[n]));return i}function C(t,n){i.options.dataSource.transport&&i.options.dataSource.transport.query?(I=s.urlBuilder(i.options.dataSource.transport.query,t),s.query(I).then(function(t){i.options.dataSource.arrayListParam&&(t=t[i.options.dataSource.arrayListParam]),Array.isArray(t)||(t=[t]),b.orderBy&&(t=u("orderBy")(t,b.orderBy)),f(i.items),e.forEach(t,function(t){i.items.push(t)})},function(t){f(i.items)})):"tree"==i.options.dataSource.type&&(f(i.items),e.forEach(n.children,function(t){i.items.push(t)}))}function v(t){i.updateRow(t).then(function(i){e.extend(t,i),b.inlineMode.id=null},function(e){b.cancelEditMode(t)})}function N(t,i){var n=!1,r=t;return e.isObject(i.isEditable)?i.isEditable.path?(e.forEach(i.isEditable.path,function(t){r&&(r=r[t])}),i.isEditable.trueValue==r&&(n=!0)):n=!1:n=i.isEditable,n}var b=this;this.gId=m(),this.titleList=[],this.titleLength=0,this.columnList=[],this.isTranscluded=!1,this.restNgGridService=s,this.options={},this.inlineMode={id:null};var G=null;this.options=e.merge({},d.options,i.options),this.apiUrl=this.options.dataSource.transport,i.items=i.items||[];var I="";this.orderBy=this.options.columns.orderBy,this.parentId=this.options.dataSource.parentId||"id",this.itemId=this.options.dataSource.itemId,i.currentItem={id:null},i.localeId=p.id,this.addColumns=function(t,i){if(i&&i.columns&&i.columns.titles&&(e.isArray(i.columns.titles)?(n(i.columns.titles,function(e){t.titleList.push(e)}),t.titleLength=i.columns.titles.length):e.isNumber(i.columns.titles)&&(t.titleLength=i.columns.titles)),i&&i.columns&&i.columns.fields){var r,a="",l=0,d="",s="",o="",c={},u={},p=!1,g="",m=!1,f="",h=null;n(i.columns.fields,function(e){a=e.field||"",l=e.colspan||0,d=e.style||{width:"auto"},s=e.filter||{name:"",format:""},o=e.type||"text",c=e.validation||{required:!1},u=e.visibility||{bitMask:null,field:[]},p=e.isEditable||!1,g=e.link||"",m=e.onChange||!1,f=e.inputName||"mj-input",h=e.radioValue||null,r=e.changeChildren||!1,t.columnList.push({field:a,colspan:l,style:d,filter:s,type:o,validation:c,visibility:u,isEditable:p,link:g,onChange:m,inputName:f,radioValue:h,changeChildren:r})})}},this.closeGroups=function(){n(i.items,function(t){t.isOpen=!1})},this.toggleRow=function(n,r){n&&(n.preventDefault(),n.stopImmediatePropagation()),b.isTranscluded&&(r.isOpen=!r.isOpen),e.isFunction(i.selectItem)&&i.selectItem(r),t.$broadcast("selectRow",{id:r.id,gId:b.gId}),r.isOpen&&(b.itemId&&(i.params[b.itemId]=r.id),"tree"==i.options.dataSource.type?t.$broadcast("expandRow",r):(i.params=h(r,i.params),t.$broadcast("expandRow",{id:r.id,gId:b.gId})))},this.selectRow=function(n,r,a){!n||a||a.link||(n.preventDefault(),n.stopImmediatePropagation()),i.currentItem.id=r.id,e.isFunction(i.selectItem)&&i.selectItem(r),t.$broadcast("selectRow",{id:r.id,gId:b.gId})};var y=t.$on("expandRow",function(t,e){i.$parent.parentItem&&i.$parent.parentItem.id===e.id&&i.$parent.parentItem.gId===e.gId&&(i.params=i.$parent.params,C(i.params,e))}),w=t.$on("selectRow",function(t,e){b.gId==e.gId?i.currentItem.id=e.id:i.currentItem.id=null}),$=t.$on("addNewRow",function(t,e){i.$parent.parentItem&&i.$parent.parentItem.id===e.item[b.parentId]&&(b.options.gridUniqueId&&b.options.gridUniqueId===e.gridUniqueId?i.items.push(e.item):b.options.gridUniqueId||i.items.push(e.item))});this.addItem=function(t){b.inlineMode.id=null,G=null,i.addRow&&i.addRow(t).then(function(t){i.options.dataSource.transport.query&&(e.isArray(i.items)||(i.items=[i.items]),t&&i.items.push(t))},function(t){})},this.addChildItem=function(e){b.inlineMode.id=null,G=null,i.addChildRow(e).then(function(i){b.toggleRow(null,e),e[b.options.childCount]=e[b.options.childCount]+1,b.selectRow(null,e),t.$broadcast("addNewRow",{item:i})},function(){console.log("handle error")})},this.editItem=function(t){i.params[b.itemId]=t.id,i.params[b.parentId]=t[b.parentId],"inline"==b.options.editMode&&(b.inlineMode.id=t.id,G=e.copy(t)),i.updateRow&&"modal"==b.options.editMode&&v(t)},this.saveRow=function(t,n){i.params[b.itemId]=t.id,i.params[b.parentId]=t[b.parentId],i.updateRow?v(t):(I=s.urlBuilder(b.apiUrl.update,i.params),b.restNgGridService.update(I,t).then(function(i){e.extend(t,i),b.inlineMode.id=null},function(e){b.cancelEditMode(t)}))},this.cancelEditMode=function(t){b.inlineMode.id=null,e.extend(t,G),G=null},this.ModalInstanceDelete=function(t,e,i){return t.deleteObjectName=i,t.confirm=function(t){return e.close(t)},t.cancel=function(){return e.dismiss("cancel")}},this.deleteItem=function(t){b.deleteRow(t)},this.deleteRow=function(t){var e="";return o.open({template:g.get("rest-ng-grid-delete.html"),controller:b.ModalInstanceDelete,animation:!1,backdrop:!0,resolve:{name:function(){return t.name}}}).result.then(function(){i.params[b.itemId]=t.id,i.params[b.parentId]=t[b.parentId],e=s.urlBuilder(b.apiUrl["delete"],i.params),b.restNgGridService["delete"](e).then(function(e){var n=i.items.indexOf(t);n>=0&&i.items.splice(n,1)},function(t){console.log("handle error")})})},this.getValue=function(t,i,n,r){var a=t,l=null;return e.isArray(i)||(i=[i]),!r||(e.isArray(r.field)||(r.field=[r.field]),e.forEach(r.field,function(t){l=a[t]}),!l||r.bitMask&l)?(n&&!e.isArray(n)&&(n=[n]),e.forEach(i,function(t){a&&(a=a[t])}),e.forEach(n,function(t){a&&t.name&&t.format&&(a=u(t.name)(a,t.format))}),a):""},this.checkIfContent=function(t,e){var n=N(t,e);return b.inlineMode.id!==t.id&&!i.editAllRows||!n},this.checkIfEdit=function(t,e){var n=N(t,e);return(b.inlineMode.id==t.id||i.editAllRows)&&n},this.checkIfRowEditable=function(t){var i=!1;return e.forEach(b.columnList,function(e){i||(i=N(t,e))}),i},this.changeCellEvent=function(t,e){e.onChange&&e.onChange(t),e.changeChildren&&"tree"!==i.options.dataSource.type?i.$broadcast("changeChildren",{item:t,column:e}):e.changeChildren&&s.updateChildrenColumn(t,e.field)},this.onCellLinkClick=function(t,e,i){i(t[e])},i.$watch("getDataTrigger",function(t){t&&(f(i.items),C(i.params,t),i.getDataTrigger=!1)}),i.$watch("getExpandRowTrigger",function(t){t&&b.selectRow(null,{id:t})});var R=t.$on("editTriggerHandler",function(t,e){"all"==e.type&&(i.editAllRows=e.status)}),k=i.$on("changeChildren",function(t,e){});i.editTrigger=function(e){"all"==e.type&&t.$broadcast("editTriggerHandler",{type:e.type,status:e.status})},i.$on("$localeChangeSuccess",function(t){i.localeId=p.id}),i.$on("$destroy",y,$,R,w,k)}]).directive("restNgGrid",["$compile","$templateCache",function(t,e){return{restrict:"EA",transclude:!0,template:e.get("rest-ng-grid.html"),controller:"RestNgGridCtrl",controllerAs:"restNgGridCtrl",scope:{options:"=?",items:"=?",params:"=?",addRow:"=?",addChildRow:"=?",updateRow:"=?",getDataTrigger:"=?",editTrigger:"=?",gridClass:"@",footerOptions:"=?",selectItem:"=?",isReadOnly:"=?",getExpandRowTrigger:"=",editAllRows:"="},link:function(t,e,i,n){n.addColumns(n,n.options)}}}]).directive("restNgGridTransclude",["$templateCache","$compile",function(t,e){function i(t,e,i,n,r){var a,l;if(n){var d=t.$parent.$parent.$new();d.parentItem=t.$eval(i.currentItem),d.parentItem.gId=n.gId,d.params=t.$eval(i.params),r(d,function(t,i){e.empty(),t.length>0?n.isTranscluded=!0:n.isTranscluded=!1,e.append(t),a=t,l=i})}e.on("$destroy",function(){a.remove(),l.$destroy()})}return{require:"^?restNgGrid",link:i,restrict:"A"}}]).directive("restGridChildren",["$templateCache",function(t){return{restrict:"E",replace:!0,template:t.get("rest-ng-grid-select-group.html"),scope:{collection:"=?",options:"=?",field:"=",filter:"="},link:function(t,i,n){t.collection&&(e.isArray(t.collection)||(t.collection=[t.collection])),t.setValue=function(t,i,n){var r=t;return e.isArray(i)||(i=[i]),n&&!e.isArray(n)&&(n=[n]),e.forEach(i,function(t){r&&(r=r[t])}),e.forEach(n,function(t){r&&t.name&&t.format&&(r=$filter(t.name)(r,t.format))}),r}}}}])}(window,window.angular),!function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid-delete.html",'<div class="modal-header"><button type="button" class="close" data-ng-click="cancel()">Ã—</button><h4 class="modal-title">Delete</h4></div><div class="modal-body"><p>Delete <strong>{{deleteObjectName}}</strong>, Are you sure?</p></div><div class="modal-footer"><button type="button" class="btn" ng-click="cancel()">Cancel</button> <button type="button" class="btn btn-danger" ng-click="confirm()">Delete</button></div>')}])}(),!function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid-select-group.html",'<div class="list"><ul><li data-ng-include="\'rest-ng-grid-sub-level.html\'" data-ng-repeat="member in collection"></li></ul></div>')}])}(),!function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid-sub-level.html",'<span>{{ setValue(member, field, filter) }}</span><ul><li ng-repeat="member in member[options.childrenParam]" ng-include="\'rest-ng-grid-sub-level.html\'"></li></ul>')}])}(),!function(t){try{t=angular.module("restNgGrid")}catch(e){t=angular.module("restNgGrid",[])}t.run(["$templateCache",function(t){t.put("rest-ng-grid.html",'<div data-ng-style="{{ restNgGridCtrl.options.style }}" class="mj-grid {{ restNgGridCtrl.options.gridClass }}" data-ng-class="{\'no-title\':\nrestNgGridCtrl.titleList.length == 0}"><div class="mj-grid-header"><div class="mj-grid-header-wrap"></div></div><div class="mj-grid-content"><!--{{ $id }}--><table role="grid" class="table table-responsive out"><thead role="rowgroup" data-ng-if="restNgGridCtrl.titleList.length > 0"><tr role="row"><th ng-style="{{ t.style }}" colspan="{{ t.colspan }}" role="columnheader" data-ng-repeat="t in restNgGridCtrl.titleList"><span ng-show="t.title[localeId]">{{ t.title[localeId] }}</span> <span ng-show="!t.title[localeId]">{{ t.title }}</span></th><th class="text-right options-col" data-ng-if="(restNgGridCtrl.apiUrl.save || restNgGridCtrl.apiUrl.update || restNgGridCtrl.apiUrl.delete) && !isReadOnly"><a data-ng-if="restNgGridCtrl.apiUrl.save" href="" ng-click="restNgGridCtrl.addItem()"><i class="fa fa-plus"></i></a></th></tr></thead><tbody role="rowgroup"><tr class="m-master" data-ng-repeat-start="item in items" data-ng-class="{\'active\': currentItem.id == item.id}"><td ng-style="{{ c.style }}" colspan="{{ c.colspan }}" data-ng-click="restNgGridCtrl.selectRow($event, item, c)" data-ng-repeat="c in restNgGridCtrl.columnList"><a href="" data-ng-if="(((item[restNgGridCtrl.options.childCount] > 0 || item.children.length > 0) ||\n\t\t\t\t\t\t(!item[restNgGridCtrl.options.childCount] && item[restNgGridCtrl.options.childCount] != 0)) && $index == 0 &&\n\t\t\t\t\t\trestNgGridCtrl.isTranscluded)" class="sub fa" data-ng-click="restNgGridCtrl.toggleRow($event, item)" data-ng-class="{\'fa-plus-square-o\': !item.isOpen, \'fa-minus-square-o\': item.isOpen}">&nbsp;</a> <span data-ng-if="(item[restNgGridCtrl.options.childCount] == 0 && $index == 0 && restNgGridCtrl.isTranscluded) ||\n\t\t\t\t\t\t\t(restNgGridCtrl.options.dataSource.type == \'tree\' && item.children.length == 0 && $index == 0)" class="sub fa fa-square-o">&nbsp;</span><div class="cell-content"><span data-ng-if="restNgGridCtrl.checkIfContent(item, c)"><span data-ng-if="!c.link">{{ restNgGridCtrl.getValue(item, c.field, c.filter, c.visibility) }}</span> <a data-ng-if="c.link" data-ng-click="restNgGridCtrl.onCellLinkClick(item, c.field, c.link)">{{ restNgGridCtrl.getValue(item, c.field, c.filter, c.visibility) }}</a> </span><span data-ng-if="restNgGridCtrl.checkIfEdit(item, c)"><input data-ng-change="restNgGridCtrl.changeCellEvent(item, c)" type="{{ c.type }}" class="form-control input-sm" data-ng-model="item[c.field]" name="{{ c.inputName }}" ng-value="{{ c.radioValue }}" data-ng-required="c.validation.required"></span><ul class="mj-children" data-ng-if="item[restNgGridCtrl.options.childrenParam]"><li data-ng-repeat="itemCh in item[restNgGridCtrl.options.childrenParam]"><!--{{ restNgGridCtrl.getValue(itemCh, c.field, c.filter) }}--><rest-grid-children collection="[itemCh]" field="c.field" filter="c.filter" options="{childrenParam:\'children\'}"></li></ul></div></td><td class="dropdown-menu-td" data-ng-if="(restNgGridCtrl.apiUrl.save || restNgGridCtrl.apiUrl.update ||\n        restNgGridCtrl.apiUrl.delete) &&\n        !isReadOnly"><div data-ng-if="restNgGridCtrl.options.rowOptions == \'dropdown\'" class="dropdown right" uib-dropdown><a href="" class="dropdown-toggle" uib-dropdown-toggle><i class="fa fa-cogs small"></i></a><ul class="dropdown-menu extended small" uib-dropdown-menu><li data-ng-if="restNgGridCtrl.apiUrl.save && addChildRow && restNgGridCtrl.isTranscluded"><a href="" data-ng-click="restNgGridCtrl.addChildItem(item, $event)"><span class="fa fa-plus"></span> Add</a></li><li data-ng-if="restNgGridCtrl.apiUrl.update"><a href="" data-ng-click="restNgGridCtrl.editItem(item, $event)"><span class="fa fa-pencil"></span> Edit</a></li><li data-ng-if="restNgGridCtrl.apiUrl.delete"><a href="" data-ng-click="restNgGridCtrl.deleteItem(item, $event)"><span class="fa fa-times"></span>Delete</a></li></ul></div><div data-ng-if="(restNgGridCtrl.options.rowOptions == \'inline\') && !isReadOnly" class="list-options no-drp"><button data-ng-if="restNgGridCtrl.inlineMode.id == item.id" class="h-r" data-ng-click="restNgGridCtrl.cancelEditMode(item)"><span class="fa fa-close"></span></button> <button data-ng-if="restNgGridCtrl.inlineMode.id == item.id" class="h-r" data-ng-click="restNgGridCtrl.saveRow(item, $event)"><span class="fa fa-check"></span></button> <button data-ng-if="restNgGridCtrl.apiUrl.save && addChildRow && restNgGridCtrl.isTranscluded && !restNgGridCtrl.inlineMode.id" uib-tooltip-popup-delay="100" uib-tooltip="Add child" tooltip-placement="bottom" class="h-r" data-ng-click="restNgGridCtrl.addChildItem(item, $event)"><span class="fa fa-plus"></span></button> <button data-ng-if="restNgGridCtrl.apiUrl.update && !restNgGridCtrl.inlineMode.id &&\n\t\t\t\t\t\trestNgGridCtrl.checkIfRowEditable(item)" uib-tooltip-popup-delay="100" uib-tooltip="Edit" tooltip-placement="bottom" class="h-r" data-ng-click="restNgGridCtrl.editItem(item, $event)"><span class="fa fa-pencil"></span></button> <button data-ng-if="restNgGridCtrl.apiUrl.delete && !restNgGridCtrl.inlineMode.id" uib-tooltip-popup-delay="100" uib-tooltip="Delete" tooltip-placement="bottom" class="h-r" data-ng-click="restNgGridCtrl.deleteItem(item, $event)"><span class="fa fa-times"></span></button></div></td></tr><tr data-ng-show="restNgGridCtrl.isTranscluded && item.isOpen" class="m-detail" data-ng-repeat-end><td colspan="{{ restNgGridCtrl.titleLength + 2}}" rest-ng-grid-transclude current-item="item" params="params">&nbsp;</td></tr></tbody></table></div><div id="mj-footer" class="mj-grid-footer" ng-include="restNgGridCtrl.options.footer"></div></div>')}])}();